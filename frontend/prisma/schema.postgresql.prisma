// Prisma schema for Digital Transaction Ledger CRM - PostgreSQL (Production)
// This schema defines the database models for clients and transactions

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Client {
  id          String        @id @default(cuid())
  name        String
  phoneNumber String        @map("phone_number")
  email       String?
  joinDate    DateTime      @default(now()) @map("join_date")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  
  transactions Transaction[]

  @@map("clients")
}

model Transaction {
  id                String   @id @default(cuid())
  clientId          String   @map("client_id")
  type              String   // "CASH_EXCHANGE" or "BANK_TRANSFER"
  sendCurrency      String   @map("send_currency")
  sendAmount        Float    @map("send_amount")
  receiveCurrency   String   @map("receive_currency")
  receiveAmount     Float    @map("receive_amount")
  rateApplied       Float    @map("rate_applied")
  feeCharged        Float    @map("fee_charged") @default(0)
  beneficiaryName   String?  @map("beneficiary_name")
  beneficiaryDetails String? @map("beneficiary_details")
  userNotes         String?  @map("user_notes")
  isEdited          Boolean  @default(false) @map("is_edited")
  lastEditedAt      DateTime? @map("last_edited_at")
  editHistory       String?  @map("edit_history") // JSON string
  transactionDate   DateTime @default(now()) @map("transaction_date")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  
  client Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("transactions")
  @@index([clientId])
  @@index([transactionDate])
}
